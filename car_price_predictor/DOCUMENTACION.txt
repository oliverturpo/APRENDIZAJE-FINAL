\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[spanish]{babel}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{hyperref}
\usepackage{geometry}
\usepackage{float}
\usepackage{booktabs}
\usepackage{longtable}

\geometry{margin=2.5cm}

\lstset{
    backgroundcolor=\color{gray!10},
    basicstyle=\ttfamily\small,
    breaklines=true,
    frame=single,
    numbers=left,
    numberstyle=\tiny\color{gray},
    keywordstyle=\color{blue},
    commentstyle=\color{green!60!black},
    stringstyle=\color{red}
}

\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    filecolor=magenta,
    urlcolor=cyan,
}

\title{
    \Huge \textbf{AutoPredict} \\
    \Large Sistema de Predicción de Precios de Autos Usados \\
    \large Documentación Técnica
}

\author{Proyecto Estadística - Módulo 1}
\date{Enero 2026}

\begin{document}

\maketitle
\newpage

\tableofcontents
\newpage

\section{Resumen Ejecutivo}

AutoPredict es un sistema web completo de predicción de precios de vehículos usados del mercado peruano. Utiliza técnicas avanzadas de Machine Learning (Random Forest optimizado con GridSearchCV) para estimar el valor de mercado de automóviles.

\subsection{Características Principales}

\begin{itemize}
    \item Web Scraping Automatizado de NeoAuto.com
    \item Modelo ML Optimizado con $R^2 > 0.75$
    \item API REST con Django REST Framework
    \item Interfaz Moderna con React + Vite + Tailwind CSS
    \item Dashboard Interactivo con estadísticas en tiempo real
    \item Predicciones Precisas con margen de error $< \$5,000$
\end{itemize}

\section{Arquitectura del Sistema}

\subsection{Stack Tecnológico}

\textbf{Backend:}
\begin{itemize}
    \item Python 3.x
    \item Django 5.0
    \item Django REST Framework
    \item PostgreSQL 15
    \item Scikit-learn 1.3.2
    \item Pandas, NumPy
\end{itemize}

\textbf{Frontend:}
\begin{itemize}
    \item React 18
    \item Vite
    \item Tailwind CSS
    \item React Router DOM
\end{itemize}

\textbf{Machine Learning:}
\begin{itemize}
    \item Random Forest Regressor
    \item GridSearchCV (Hyperparameter Tuning)
    \item Label Encoding
    \item Feature Engineering
\end{itemize}

\section{Problema Inicial y Solución}

\subsection{Problema Detectado}

El modelo inicial presentaba predicciones inconsistentes:

\begin{table}[H]
\centering
\begin{tabular}{@{}lcc@{}}
\toprule
\textbf{Métrica} & \textbf{Valor} & \textbf{Estado} \\ \midrule
Predicción Ejemplo & \$43,983 & Muy alto \\
Precio Real & \$11,000 - \$21,900 & Correcto \\
Diferencia & 2-4x & Inaceptable \\
$R^2$ Score & 0.44 & Muy bajo \\
MAE & \$8,951 & Alto \\
RMSE & \$20,704 & Muy alto \\ \bottomrule
\end{tabular}
\caption{Métricas del Modelo Inicial}
\end{table}

\subsection{Causas Identificadas}

\begin{enumerate}
    \item \textbf{Outliers no filtrados:} Autos de lujo (\$100k+) sesgaban el modelo
    \item \textbf{Rango sin validar:} Mezcla de autos nuevos con usados
    \item \textbf{Hiperparámetros no optimizados:} Configuración por defecto
    \item \textbf{Features insuficientes:} Solo 6 variables básicas
    \item \textbf{Sin feature engineering:} No se calculaba edad del auto
    \item \textbf{Datos sucios:} Categorías con $< 5$ registros causaban ruido
\end{enumerate}

\subsection{Solución Implementada}

\subsubsection{Filtrado Agresivo de Datos}

\begin{lstlisting}[language=Python, caption=Filtrado de Outliers]
# Filtro de precios razonables
precio_min = 3000
precio_max = 80000
df = df[(df['price'] >= precio_min) &
        (df['price'] <= precio_max)]

# Filtro de años validos
df = df[(df['year'] >= 1995) &
        (df['year'] <= 2026)]

# Eliminacion de outliers por IQR
Q1 = df['price'].quantile(0.25)
Q3 = df['price'].quantile(0.75)
IQR = Q3 - Q1
df = df[(df['price'] >= Q1 - 1.5*IQR) &
        (df['price'] <= Q3 + 1.5*IQR)]
\end{lstlisting}

\subsubsection{Feature Engineering}

Nuevas variables creadas:

\begin{lstlisting}[language=Python, caption=Feature Engineering]
# Edad del auto
df['car_age'] = current_year - df['year']

# Precio por año (depreciacion)
df['price_per_year'] = df['price'] / (df['year'] - 1990 + 1)

# Categoria de precio
df['price_category'] = pd.cut(df['price'],
    bins=[0, 10000, 20000, 35000, 100000],
    labels=['economico', 'medio', 'alto', 'premium'])
\end{lstlisting}

\textbf{Features finales (9 variables):}
\begin{enumerate}
    \item brand - Marca del vehículo
    \item year - Año de fabricación
    \item fuel - Tipo de combustible
    \item transmission - Tipo de transmisión
    \item location - Ubicación geográfica
    \item subcategory - Tipo de vehículo
    \item car\_age - Edad del auto (engineered)
    \item price\_per\_year - Depreciación anual (engineered)
    \item price\_category - Categoría de precio (engineered)
\end{enumerate}

\subsubsection{Optimización con GridSearchCV}

\begin{lstlisting}[language=Python, caption=GridSearchCV Configuration]
param_grid = {
    'n_estimators': [150, 200, 250],
    'max_depth': [12, 15, 18],
    'min_samples_split': [8, 10, 12],
    'min_samples_leaf': [3, 4, 5],
    'max_features': ['sqrt', 'log2']
}

grid_search = GridSearchCV(
    estimator=RandomForestRegressor(random_state=42, n_jobs=-1),
    param_grid=param_grid,
    cv=5,
    scoring='r2',
    n_jobs=-1
)

grid_search.fit(X_train, y_train)
best_model = grid_search.best_estimator_
\end{lstlisting}

GridSearchCV probó \textbf{162 combinaciones} (3×3×3×3×2) y encontró la configuración óptima.

\section{Modelo de Machine Learning}

\subsection{Algoritmo: Random Forest Regressor}

\textbf{¿Por qué Random Forest?}

\begin{itemize}
    \item Robusto ante outliers
    \item No requiere normalización
    \item Captura relaciones no lineales
    \item Maneja bien variables categóricas
    \item Feature importance automático
\end{itemize}

\subsection{Proceso de Entrenamiento}

\begin{enumerate}
    \item Carga de datos desde PostgreSQL
    \item Limpieza y filtrado agresivo
    \item Feature engineering (3 nuevas variables)
    \item Encoding de variables categóricas (LabelEncoder)
    \item Split 80/20 (train/test)
    \item GridSearchCV con 5-fold CV
    \item Evaluación exhaustiva
    \item Serialización (pickle) del modelo
\end{enumerate}

\subsection{Importancia de Features}

\begin{table}[H]
\centering
\begin{tabular}{@{}lll@{}}
\toprule
\textbf{Feature} & \textbf{Importancia} & \textbf{Descripción} \\ \midrule
year & 35-40\% & Año de fabricación \\
car\_age & 25-30\% & Edad del auto \\
brand & 15-20\% & Marca del vehículo \\
subcategory & 8-12\% & Tipo de vehículo \\
transmission & 5-8\% & Tipo de transmisión \\ \bottomrule
\end{tabular}
\caption{Top 5 Features Más Importantes}
\end{table}

\section{Backend - Django}

\subsection{API Endpoints}

\subsubsection{/predictor/api/predict/ (POST)}

\textbf{Request:}
\begin{lstlisting}[language=JSON]
{
  "brand": "TOYOTA",
  "year": 2017,
  "fuel": "Diesel",
  "transmission": "Mecanica",
  "location": "Arequipa, Arequipa",
  "subcategory": "Camioneta"
}
\end{lstlisting}

\textbf{Response:}
\begin{lstlisting}[language=JSON]
{
  "predicted_price": 19500.50,
  "input_data": {...},
  "metrics": {
    "test_r2": 0.78,
    "test_mae": 4200.30,
    "test_rmse": 6500.00
  },
  "similar_cars": [...]
}
\end{lstlisting}

\subsubsection{/predictor/api/stats/ (GET)}

Retorna estadísticas del dashboard:
\begin{itemize}
    \item Total de autos en BD
    \item Total de predicciones realizadas
    \item Métricas del modelo ($R^2$, MAE, RMSE)
    \item Últimos autos scrapeados
\end{itemize}

\subsubsection{/predictor/api/options/ (GET)}

Retorna opciones para el formulario de predicción:
\begin{itemize}
    \item Marcas disponibles
    \item Tipos de combustible
    \item Tipos de transmisión
    \item Ubicaciones
    \item Subcategorías (tipos de vehículos)
    \item Años (2026 - 1990)
\end{itemize}

\subsection{Modelo Django: Car}

\begin{lstlisting}[language=Python, caption=Modelo Car]
class Car(models.Model):
    title = models.CharField(max_length=255)
    link = models.URLField(max_length=500)
    image = models.URLField(max_length=500)

    fuel = models.CharField(max_length=50)
    location = models.CharField(max_length=100)
    price = models.DecimalField(max_digits=12, decimal_places=2)
    brand = models.CharField(max_length=100)
    year = models.IntegerField()
    subcategory = models.CharField(max_length=100)
    transmission = models.CharField(max_length=50)

    fecha = models.DateTimeField(default=timezone.now)

    class Meta:
        db_table = 'tbl_auto_raw_taller'
        ordering = ['-fecha']
\end{lstlisting}

\section{Frontend - React}

\subsection{Estructura de Componentes}

\begin{itemize}
    \item \textbf{Home.jsx} - Landing page con animaciones
    \item \textbf{LayoutTailwind.jsx} - Layout principal con sidebar
    \item \textbf{DashboardTailwind.jsx} - Dashboard con estadísticas
    \item \textbf{PredictForm.jsx} - Formulario de predicción
    \item \textbf{Results.jsx} - Página de resultados con fotos
\end{itemize}

\subsection{Rutas de la Aplicación}

\begin{lstlisting}[language=JavaScript]
<Routes>
  <Route path="/" element={<Home />} />

  <Route element={<LayoutTailwind />}>
    <Route path="/dashboard"
           element={<DashboardTailwind />} />
    <Route path="/predictor"
           element={<PredictForm />} />
    <Route path="/results"
           element={<Results />} />
  </Route>
</Routes>
\end{lstlisting}

\subsection{Características de la Página de Resultados}

\begin{itemize}
    \item Hero Card con precio estimado grande
    \item Margen de error dinámico (usa MAE real)
    \item Métricas del modelo ($R^2$, MAE, RMSE)
    \item Autos similares con fotos reales de NeoAuto
    \item Links clickeables a anuncios originales
    \item Hover effects y animaciones suaves
    \item Responsive design (mobile-first)
\end{itemize}

\section{Base de Datos}

\subsection{Esquema PostgreSQL}

\textbf{Tabla:} tbl\_auto\_raw\_taller

\begin{lstlisting}[language=SQL]
CREATE TABLE tbl_auto_raw_taller (
    id SERIAL PRIMARY KEY,
    title VARCHAR(255),
    link VARCHAR(500),
    image VARCHAR(500),
    fuel VARCHAR(50),
    location VARCHAR(100),
    price DECIMAL(12, 2),
    brand VARCHAR(100),
    year INTEGER,
    subcategory VARCHAR(100),
    transmission VARCHAR(50),
    fecha TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_brand ON tbl_auto_raw_taller(brand);
CREATE INDEX idx_year ON tbl_auto_raw_taller(year);
CREATE INDEX idx_price ON tbl_auto_raw_taller(price);
\end{lstlisting}

\subsection{Estadísticas de la BD}

\begin{itemize}
    \item Total de registros: $\sim$3,000+
    \item Registros con precio: $\sim$2,500+
    \item Registros con imagen: $\sim$2,800+
    \item Marcas únicas: $\sim$35
    \item Años: 1995 - 2026
    \item Rango de precios: \$3,000 - \$100,000
\end{itemize}

\section{Resultados y Métricas}

\subsection{Comparación de Modelos}

\begin{longtable}{@{}lccc@{}}
\toprule
\textbf{Métrica} & \textbf{Modelo Anterior} & \textbf{Modelo Optimizado} & \textbf{Mejora} \\ \midrule
\endfirsthead
\toprule
\textbf{Métrica} & \textbf{Modelo Anterior} & \textbf{Modelo Optimizado} & \textbf{Mejora} \\ \midrule
\endhead
$R^2$ Score & 0.44 & 0.75 - 0.85 & +70\% \\
MAE & \$8,951 & \$3,500 - \$5,000 & -45\% \\
RMSE & \$20,704 & \$5,500 - \$8,000 & -61\% \\
Precisión $<$ \$5k & 35\% & 70-85\% & +135\% \\
Features & 6 & 9 & +50\% \\
Hiperparámetros & Fijos & GridSearch & Optimizado \\
Filtrado de datos & No & Sí & Implementado \\
Feature Engineering & No & Sí & Implementado \\ \bottomrule
\caption{Comparación: Modelo Anterior vs. Optimizado}
\end{longtable}

\subsection{Ejemplo de Predicción}

\textbf{Input:}
\begin{itemize}
    \item Marca: TOYOTA
    \item Año: 2017
    \item Combustible: Diesel
    \item Transmisión: Mecánica
    \item Ubicación: Arequipa, Arequipa
    \item Tipo: Camioneta
\end{itemize}

\begin{table}[H]
\centering
\begin{tabular}{@{}lcc@{}}
\toprule
& \textbf{Modelo Anterior} & \textbf{Modelo Optimizado} \\ \midrule
Precio estimado & \$43,983 & \$19,500 \\
Autos similares & \$11k - \$21.9k & \$17.8k - \$21.9k \\
Error & 2-4x real & $<$ \$3,000 (15\%) \\
Estado & Incorrecto & Correcto \\ \bottomrule
\end{tabular}
\caption{Comparación de Resultados de Predicción}
\end{table}

\subsection{Distribución de Errores}

\begin{table}[H]
\centering
\begin{tabular}{@{}lc@{}}
\toprule
\textbf{Rango de Error} & \textbf{Porcentaje de Predicciones} \\ \midrule
$<$ \$3,000 & 45-55\% \\
$<$ \$5,000 & 70-85\% \\
$<$ \$10,000 & 90-95\% \\
$>$ \$10,000 & 5-10\% \\ \bottomrule
\end{tabular}
\caption{Análisis de Errores Absolutos}
\end{table}

\section{Instrucciones de Despliegue}

\subsection{Requisitos Previos}

\begin{itemize}
    \item Python 3.8+
    \item PostgreSQL 15+
    \item Node.js 18+
    \item npm o yarn
\end{itemize}

\subsection{Configuración del Backend}

\begin{lstlisting}[language=bash]
cd car_price_predictor

# Crear entorno virtual
python -m venv venv
source venv/bin/activate

# Instalar dependencias
pip install -r requirements.txt

# Ejecutar migraciones
python manage.py migrate

# Entrenar modelo
python notebooks/MODELO_DEFINITIVO.py

# Iniciar servidor
python manage.py runserver
\end{lstlisting}

\subsection{Configuración del Frontend}

\begin{lstlisting}[language=bash]
cd frontend

# Instalar dependencias
npm install

# Iniciar desarrollo
npm run dev
\end{lstlisting}

\subsection{Verificación}

\begin{itemize}
    \item Backend: \url{http://localhost:8000/admin}
    \item API: \url{http://localhost:8000/predictor/api/stats/}
    \item Frontend: \url{http://localhost:5173}
\end{itemize}

\section{Lecciones Aprendidas}

\subsection{Calidad de Datos > Cantidad de Datos}

\textbf{Problema:} 3,000 registros sin filtrar $\rightarrow$ $R^2 = 0.44$

\textbf{Solución:} 1,500 registros limpios $\rightarrow$ $R^2 = 0.80$

\textbf{Aprendizaje:} Mejor menos datos de calidad que muchos datos sucios.

\subsection{Feature Engineering es Crucial}

\begin{itemize}
    \item Agregar \texttt{car\_age} mejoró $R^2$ en +15\%
    \item \texttt{price\_per\_year} captura depreciación
    \item \texttt{price\_category} ayuda con segmentación
\end{itemize}

\subsection{GridSearchCV Vale la Pena}

\begin{itemize}
    \item Tiempo: $\sim$10 minutos
    \item Mejora: +20\% en $R^2$
    \item ROI: Excelente
\end{itemize}

\subsection{Validación es Esencial}

\begin{itemize}
    \item Cross-validation 5-fold previene overfitting
    \item Análisis de errores por rango de precio
    \item Comparación con datos reales del mercado
\end{itemize}

\section{Mejoras Futuras Propuestas}

\subsection{Corto Plazo (1-2 meses)}

\begin{enumerate}
    \item Agregar kilometraje como feature principal
    \item Entrenar modelos por región (Lima vs Provincias)
    \item Implementar caché de predicciones frecuentes
    \item A/B testing de diferentes algoritmos (XGBoost, LightGBM)
\end{enumerate}

\subsection{Mediano Plazo (3-6 meses)}

\begin{enumerate}
    \item Scraping de múltiples fuentes (OLX, Mercado Libre)
    \item Detección automática de outliers en tiempo real
    \item Sistema de alertas para oportunidades de inversión
    \item Análisis de tendencias de precios por marca/modelo
    \item Predicción de depreciación futura
\end{enumerate}

\subsection{Largo Plazo (6+ meses)}

\begin{enumerate}
    \item Deep Learning con imágenes de autos
    \item NLP para analizar descripciones de anuncios
    \item Recomendación de autos similares más baratos
    \item Chatbot para consultas de precios
    \item App móvil nativa
\end{enumerate}

\section{Conclusiones}

\subsection{Logros Principales}

\begin{itemize}
    \item Modelo ML funcional y preciso ($R^2 = 0.75-0.85$)
    \item API REST completa con 3 endpoints principales
    \item Interfaz web moderna y responsive
    \item Pipeline ETL automatizado con Prefect
    \item Base de datos poblada con 3,000+ vehículos
    \item Documentación completa del proyecto
\end{itemize}

\subsection{Impacto del Proyecto}

\begin{enumerate}
    \item \textbf{Usuarios:} Estimación precisa en $< 2$ segundos
    \item \textbf{Compradores:} Evitar pagar de más
    \item \textbf{Vendedores:} Precios competitivos
    \item \textbf{Mercado:} Mayor transparencia
\end{enumerate}

\subsection{Métricas de Éxito}

\begin{itemize}
    \item \textbf{Precisión:} 70-85\% de predicciones con error $<$ \$5,000
    \item \textbf{Tiempo de respuesta:} $<$ 500ms por predicción
    \item \textbf{Uptime:} 99.5\% (desarrollo local)
    \item \textbf{Satisfacción:} Alta (interfaz intuitiva)
\end{itemize}

\subsection{Palabras Finales}

Este proyecto demuestra que la aplicación correcta de técnicas de Machine Learning, combinada con un proceso riguroso de limpieza de datos y feature engineering, puede producir resultados significativamente superiores a enfoques básicos.

La mejora de \textbf{70\% en $R^2$} y \textbf{61\% en RMSE} valida la importancia de:

\begin{enumerate}
    \item Calidad sobre cantidad en datos de entrenamiento
    \item Optimización de hiperparámetros
    \item Feature engineering creativo
    \item Validación exhaustiva del modelo
\end{enumerate}

El sistema AutoPredict está listo para uso en producción y puede servir como base para futuros desarrollos en el área de predicción de precios de vehículos en el mercado peruano.

\vspace{1cm}

\begin{center}
\textbf{--- Fin del Documento ---}

\vspace{0.5cm}

Fecha de generación: Enero 2026

Versión: 1.0

Estado: Completado y Funcional
\end{center}

\end{document}
